<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="game.css">
    <script type="text/javascript" src="vue.js"></script>
    <title>game</title>
</head>
<body>
<div class="game" id="game">
    <div class="top">
        <div class="person" id="person">
            <ul>
                <li >生命：<span class="health" :style="{backgroundColor:person.healthcolor,width:(person.nowhealth/crreathealth)*80 + '%'}">{{person.nowhealth}}/{{crreathealth}}</span></li>
                <li>防御：{{person.armor}}</li>
                <li>攻击：{{person.attack}}</li>
                <li>暴击：{{person.crit}}</li>
                <li>真实伤害：{{person.hurt}}</li>
                <li>经验值：{{person.nowexp}}/{{person.exp}}</li>
                <li>当前等级：{{person.level}}</li>
            </ul>
        </div>
        <div class="main">
            <h3 id="maintxt">{{maintxt}}</h3>
        </div>
    </div>
    <div class="down">
        <div class="fight">
            <ul>
                <li v-for="(item,index) in fighttxts">
                    <span>系统提示：</span><span v-bind:style="{color: item.color}"> {{ item.txt }}</span>
                </li>
            </ul>
        </div>
        <div class="choose"id="choose">
            <button v-on:click="start">开始</button>
            <button>暂停</button>
        </div>
    </div>
</div>
<script type="text/javascript" >
    window.onload= function(){
        var person=new Vue({
            el:"#game",
            data: {
                maintxt:"你开始探险",//主文本
                fighttxts:[],//战斗文本
                //角色
                person:{
                    health:1000,//总生命值
                    nowhealth:1000,//当前生命值
                    armor:10,//防御
                    attack:100,//攻击
                    crit:0,//暴击
                    hurt:0,//真实伤害
                    level:1,
                    exp:100,
                    nowexp:0,
                    healthcolor:"green",
                   // test:1
                },
                //怪物
                monster:{
                    name:"",
                    health:100,//总生命值
                    nowhealth:100,//当前生命值
                    armor:10,//防御
                    attack:100,//攻击
                    crit:0,//暴击
                    exp:100
                }
            },
            computed:{
                crreathealth: function () {
                    return 900+110*this.person.level;
                },
//                creatnowhealth: function () {
//                    return this.crreathealth;
//                },
            },
            watch:{
                person:{
                    handler:function(){
                        //监听血量，过低就用红色背景显示
                        if(this.person.nowhealth<=this.person.health*0.2){
                       this.person.healthcolor="red";
                       var str={txt:"你他娘的快G了！别打了，快跑啊",color:"red"};
                       this.showtxt(str);
                                }else {
                       this.person.healthcolor="green";
                       //监听经验值，满了就升级
                       while (this.person.nowexp>=this.person.exp){
                           this.person.level++;
                           this.person.nowexp-=this.person.exp;
                           this.person.exp=parseInt(this.person.exp*1.2);

                           var str={txt:"恭喜您升到"+this.person.level+"级，您又变强了！",color:"yellow"};
                           this.showtxt(str);
                       };
                   }
                            },deep:true}//deep：true监听遍历对象属性
                        },
            methods:{
                start:function(){
                    this.creatmonster();
                    this.fight();
                    //this.person.test++;
                },
                creatmonster:function () {
                    this.monster.name="野猪";
                    this.maintxt="你遭遇了一只"+this.monster.name;
                },
                fight:function () {
                    this.person.nowhealth-=this.monster.attack;
                    if (this.person.nowhealth>0){
                         this.suc();
                    }else {
                         this.def();
                    }
                },
                //传入战斗信息 并显示
                showtxt:function (str) {
                    this.fighttxts.unshift(str);
                },
                suc:function(){
                    var str={txt:"你击杀了一只"+this.monster.name+"。并获得"+this.monster.exp+"经验值。",color:"black"};
                    this.showtxt(str);
                    this.person.nowexp+=this.monster.exp;

                },
                def:function () {
                    while (this.person.nowhealth<=0){
                        console.log("YOU DIE");
                        this.person.nowhealth=this.person.health;
                    }
                }
            }
        });
    }
</script>
</body>
</html>